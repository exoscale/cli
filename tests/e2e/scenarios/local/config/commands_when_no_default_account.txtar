# Bug reproduction: Commands fail when account exists but no default is set
# This simulates the state after `exo config add` panic when declining to set default
# See: Bug Report - CLI exo config add panics when adding first non-default account

# Test with default config location (no --config flag)
! exec exo config show
stderr 'default account not defined'

! exec exo config list
stderr 'default account not defined'

! exec exo config set Exoscale-Test
stderr 'default account not defined'

# Workaround: --use-account flag bypasses the default account requirement
exec exo --use-account Exoscale-Test config show
stdout 'Exoscale-Test'
stdout 'EXOtest123'

# Test with explicit --config flag (same results)
! exec exo --config .config/exoscale/exoscale.toml config show
stderr 'default account not defined'

! exec exo --config .config/exoscale/exoscale.toml config list
stderr 'default account not defined'

! exec exo --config .config/exoscale/exoscale.toml config set Exoscale-Test
stderr 'default account not defined'

exec exo --config .config/exoscale/exoscale.toml --use-account Exoscale-Test config show
stdout 'Exoscale-Test'
stdout 'EXOtest123'

# Config file in broken state: has account but no defaultaccount
# This is what exists after the panic when declining to set as default
-- .config/exoscale/exoscale.toml --
[[accounts]]
name = "Exoscale-Test"
key = "EXOtest123"
secret = "testsecret123"
defaultZone = "ch-gva-2"
