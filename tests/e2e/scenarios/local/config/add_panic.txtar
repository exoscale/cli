# Test: Commands work correctly when config has account but no defaultAccount
# Previously this caused a panic at cmd/config/config.go:160 due to unsafe type assertion
# Bug fix: Changed from Get("defaultAccount").(string) to GetString("defaultAccount")
#
# Note: Cannot reproduce `exo config add` directly in testscript because it uses
# interactive prompts (promptui) for zone selection and account info, which don't
# work in testscript's non-interactive environment. See tests/integ/config_panic_test.go
# for integration test coverage.
#
# E2E test: This file verifies correct behavior with config missing defaultAccount

# Simulate config state: account exists but no defaultaccount field
mkdir -p .config/exoscale
cp config-without-default.toml .config/exoscale/exoscale.toml

# Verify commands fail when account exists but no defaultaccount
# They should fail gracefully with a clear error message, not panic
! exec exo config show
stderr 'default account not defined'

! exec exo config list
stderr 'default account not defined'

# Circular dependency: config set requires a default account to set a default account!
! exec exo config set Exoscale-Panic  
stderr 'default account not defined'

# Workaround: --use-account flag works
exec exo --use-account Exoscale-Panic config show
stdout 'Exoscale-Panic'
state: account without defaultaccount field
-- config-without-defaulten state: account without defaultaccount field
-- broken-config.toml --
[[accounts]]
name = "Exoscale-Panic"
key = "EXOpanic123"
secret = "testsecret123"
defaultZone = "ch-gva-2"
