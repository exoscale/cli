# Test: Interactive config add making new account the default
# Tests adding a second account and choosing to make it the new default.

# Create initial config with one account
mkdir -p .config/exoscale
cp initial-config.toml .config/exoscale/exoscale.toml

# Add second account and make it default (answer 'y' to prompt)
exec-pty --stdin=inputs ( exo config add )
stdout 'Set \[NewDefault\] as default account'

# Verify both accounts exist
exec exo config list
stdout 'FirstAccount'
stdout 'NewDefault'

# Verify new account is now default
stdout 'NewDefault\*'
! stdout 'FirstAccount\*'

-- inputs --
@wait:[+] API Key:
EXOnewdefault789
@wait:[+] Secret Key:
secretNew789
@wait:[+] Name:
NewDefault
@wait:Default zone
@enter
@wait:[?] Set [
y

-- initial-config.toml --
defaultAccount = "FirstAccount"

[[accounts]]
account = "FirstAccount"
defaultZone = "ch-gva-2"
key = "EXOfirst123"
name = "FirstAccount"
secret = "secretFirst123"
